---
title: "Evaluating Asteroid Characteristics and Predicting Hazard Levels Using NASA's Asteroid Classification Dataset"
author: "Vishal Bakshi, Pratiksha Dange, Sudanshu Dotel, Qibin Huang"
date: "`r Sys.Date()`"
output: 
  prettydoc::html_pretty:
    theme: cayman
    toc: yes
---

## Importing Libraries

```{r init, include=FALSE}
# some of common options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
library(ezids)
# knitr::opts_chunk$set(warning = F, results = "markup", message = F)
knitr::opts_chunk$set(warning = F, results = "hide", message = F)
options(scientific=T, digits = 3) 
library(dplyr)
library(kableExtra)

# options(scipen=9, digits = 3)  
# ‘scipen’: integer. A penalty to be applied when deciding to print numeric values in fixed or exponential notation.  Positive values bias towards fixed and negative towards scientific notation: fixed notation will be preferred unless it is more than ‘scipen’ digits wider.
# use scipen=999 to prevent scientific notation at all times
```

```{css, include=FALSE}
.columns {display: flex;}
h1 {color: #87CEFA}
h2 {color:blue}
```

<div class="column-definitions">
  <p><strong>1. Neo Reference ID:</strong> ID for the Asteroid</p>
  <p><strong>2. Name:</strong> Name of the Asteroid</p>
  <p><strong>3. Absolute Magnitude:</strong> Indicates the brightness of the asteroid; lower magnitude means a brighter star, higher magnitude means a dimmer star.</p>
  <p><strong>4. Est Dia in KM (min):</strong> Estimated minimum size of the asteroid in kilometers.</p>
  <p><strong>5. Est Dia in KM (max):</strong> Estimated maximum size of the asteroid in kilometers.</p>
  <p><strong>6. Close Approach Date:</strong> Date when the asteroid came very close to Earth's atmosphere.</p>
  <p><strong>7. Epoch Date Close Approach:</strong> A related date concerning the asteroid's close approach.</p>
  <p><strong>8. Relative Velocity (km per sec):</strong> The velocity of the asteroid.</p>
  <p><strong>9. Miss Dist. (Astronomical):</strong> The asteroid's closest approach to Earth, measured in astronomical units.</p>
  <p><strong>10. Miss Dist. (lunar):</strong> The distance in terms of the Moon's distance from Earth.</p>
  <p><strong>11. Miss Dist. (kilometers):</strong> The closest approach of the asteroid to Earth in kilometers.</p>
  <p><strong>12. Miss Dist. (miles):</strong> The closest approach in miles.</p>
  <p><strong>13. Orbiting Body:</strong> Indicates the celestial body that the asteroid orbits.</p>
  <p><strong>14. Orbit ID:</strong> An ID for the asteroid's orbit.</p>
  <p><strong>15. Orbit Determination Date:</strong> The date when the asteroid's orbit was calculated.</p>
  <p><strong>16. Orbit Uncertainty Minimum:</strong> A measure of the uncertainty in the asteroid's orbit.</p>
  <p><strong>17. Orbit Intersection:</strong> Indicates where the asteroid's orbit crosses.</p>
  <p><strong>18. Jupiter Tisserand Invariant:</strong> The JTI measures the influence of Jupiter's gravitational pull on celestial bodies; lower JTI values are farther from Jupiter.</p>
  <p><strong>19. Epoch Osculation:</strong> A specific date related to the asteroid.</p>
  <p><strong>20. Eccentricity:</strong> Determines the shape of the orbit; 0 < E < 1 indicates an ellipse, E = 1 is a parabola, and E > 1 is a hyperbola.</p>
  <p><strong>21. Semi Major Axis:</strong> Indicates the size of the asteroid's orbit.</p>
  <p><strong>22. Inclination:</strong> Denotes the tilt of the asteroid's orbit.</p>
  <p><strong>23. Asc Node Longitude:</strong> Specifies where the asteroid's orbit crosses a reference plane.</p>
  <p><strong>24. Orbital Period:</strong> Specifies how long it takes for the asteroid to complete one orbit.</p>
  <p><strong>25. Perihelion Distance:</strong> Indicates how close the asteroid gets to the Sun during its orbit.</p>
  <p><strong>26. Perihelion Arg:</strong> A measure related to the direction of the asteroid's orbit.</p>
  <p><strong>27. Aphelion Dist:</strong> Specifies how far the asteroid is from the Sun during its orbit.</p>
  <p><strong>28. Perihelion Time:</strong> The time when the asteroid is closest to the Sun.</p>
  <p><strong>29. Mean Anomaly:</strong> A measure of where the asteroid is in its orbit.</p>
  <p><strong>30. Mean Motion:</strong> Provides information about how the asteroid moves in its orbit.</p>
  <p><strong>31. Equinox:</strong> Specifies the reference point for the orbital information.</p>
  <p><strong>32. Hazardous:</strong> Target variable indicating whether the asteroid is considered hazardous to Earth; 1 for hazardous, 0 for not hazardous.</p>
</div>

<style>
  .column-definitions {
    font-family: Arial, sans-serif;
    padding: 10px;
    border: 1px solid #ccc;
    background-color: #f7f7f7;
  }
</style>



## Importing Dataset

```{r, include=TRUE, echo=FALSE, results='show'}
current_directory <- getwd()
data_path <- "Datasets/Asteroid_Hazard_Classification.csv"
file_path <- file.path(dirname(current_directory), data_path)
Ast_raw <- data.frame(read.csv(file_path))
```



## Data Preprocessing

In the data Pre-processing with respect to the dataframe: 

Step : 1 : Converting the Hazard column from string to integer, and into categorical.

```{r, include=TRUE, echo=TRUE, results='asis'}
Ast_raw <- Ast_raw %>%
mutate(Hazardous = as.integer(Hazardous))#(1 is True, 0 is False)
Ast_raw$Hazardous <- as.factor(Ast_raw$Hazardous)
```


Step : 2 : Dropping columns which are not required for our analysis:

```{r, include=TRUE, echo=TRUE, results='asis'}
# Load required libraries
library(knitr)
library(kableExtra)

selected_columns <- c('Neo.Reference.ID', 'Name', 'Absolute.Magnitude', 'Est.Dia.in.KM.min.', 'Est.Dia.in.KM.max.', 'Relative.Velocity.km.per.sec', 'Orbit.Uncertainity', 'Jupiter.Tisserand.Invariant', 'Eccentricity', 'Semi.Major.Axis', 'Inclination', 'Perihelion.Distance', 'Aphelion.Dist', 'Perihelion.Time', 'Mean.Motion', 'Hazardous')

Ast_Subset <- subset(Ast_raw, select = selected_columns)

# Create a nicely formatted table
kable(Ast_Subset, "html") %>%
  kable_styling(full_width = FALSE) %>% 
  scroll_box(width = "100%", height = "400px")

```

Step : 3 : Outlier Check: 

```{r}
find_outliers <- function(x) {
  q1 <- quantile(x, 0.25)
  q3 <- quantile(x, 0.75)
  iqr <- q3 - q1
  lower_bound <- q1 - 1.5 * iqr
  upper_bound <- q3 + 1.5 * iqr
  return(x[x < lower_bound | x > upper_bound])
}

# Find and remove outliers in the minimum diameter
outliers_min <- find_outliers(Ast_Subset$Est.Dia.in.KM.min.)
data_cleaned_min <- Ast_Subset[!(Ast_Subset$Est.Dia.in.KM.min. %in% outliers_min), ]

# Find and remove outliers in the maximum diameter
outliers_max <- find_outliers(Ast_Subset$Est.Dia.in.KM.max.)
data_cleaned_max <- Ast_Subset[!(Ast_Subset$Est.Dia.in.KM.max. %in% outliers_max), ]

par(mfrow=c(2,2))

hist(Ast_Subset$Est.Dia.in.KM.min., main="Minimum Diameter", xlab="Est Dia in KM (min)", col="blue")
hist(data_cleaned_min$Est.Dia.in.KM.min., main="Minimum Diameter (Cleaned)", xlab="Est Dia in KM (min)", col="blue")

hist(Ast_Subset$Est.Dia.in.KM.max., main="Maximum Diameter", xlab="Est Dia in KM (max)", col="blue")
hist(data_cleaned_max$Est.Dia.in.KM.max., main="Maximum Diameter (Cleaned)", xlab="Est Dia in KM (max)", col="blue")


# Q-Q plot for minimum asteroid diameter
#original data
qqnorm(Ast_Subset$Est.Dia.in.KM.min.)
qqline(Ast_Subset$Est.Dia.in.KM.min.)
#clean data
qqnorm(data_cleaned_min$Est.Dia.in.KM.min.)
qqline(data_cleaned_min$Est.Dia.in.KM.min.)


# Q-Q plot for maximum asteroid diameter

#original data
qqnorm(Ast_Subset$Est.Dia.in.KM.max.)
qqline(Ast_Subset$Est.Dia.in.KM.max.)
#clean data
qqnorm(data_cleaned_max$Est.Dia.in.KM.max.)
qqline(data_cleaned_max$Est.Dia.in.KM.max.)


shapiro.test(data_cleaned_min$Est.Dia.in.KM.min.)
shapiro.test(data_cleaned_max$Est.Dia.in.KM.max.)

#the p-values for both the minimum and maximum asteroid diameters are less than 2e-16, indicating that the data significantly deviates from a normal distribution.

```

## Data Visualization : 

## Histogram plots to check the distribution

### Part 1: 
```{r}
library(ggplot2)
# Load the tidyr package
library(tidyr)

# Create a histogram for 'Absolute.Magnitude', 'Est.Dia.in.KM.min.', and 'Est.Dia.in.KM.max'
selected_columns_1 <- Ast_Subset[c('Absolute.Magnitude', 'Est.Dia.in.KM.min.', 'Est.Dia.in.KM.max.')]

# Reshape the data into long format
Ast_Subset_long_1 <- pivot_longer(selected_columns_1, 
                                cols = everything(),
                                names_to = "Variable", values_to = "Value")

# Create the histogram
ggplot(Ast_Subset_long_1, aes(x = Value, fill = Variable, color = "black")) +
  geom_histogram(binwidth = 1.0, alpha = 0.7, position = "identity", show.legend = FALSE) +
  facet_wrap(~Variable, scales = "free") +
  labs(title = "Histogram of Absolute Magnitude, Est.Dia.in.KM.min., Est.Dia.in.KM.max", x = "Value", y = "Frequency") +
  scale_fill_manual(values = rainbow(length(unique(Ast_Subset_long_1$Variable))) ) +
  scale_color_manual(values = "black") +
  theme_minimal() +
  theme(legend.position = "right")


```

### Part 2 : 

```{r, include=TRUE, echo=TRUE, results='asis'}


# Create a histogram for 'Relative.Velocity.km.per.sec', 'Orbit.Uncertainity', and 'Jupiter.Tisserand.Invariant'
selected_columns_2 <- Ast_Subset[c('Relative.Velocity.km.per.sec', 'Orbit.Uncertainity', 'Jupiter.Tisserand.Invariant')]

# Reshape the data into long format
Ast_Subset_long_2 <- pivot_longer(selected_columns_2, 
                                cols = everything(),
                                names_to = "Variable", values_to = "Value")

# Create the histogram
ggplot(Ast_Subset_long_2, aes(x = Value, fill = Variable, color = "black")) +
  geom_histogram(binwidth = 1.0, alpha = 0.7, position = "identity", show.legend = FALSE) +
  facet_wrap(~Variable, scales = "free") +
  labs(title = "Histogram of Relative.Velocity.km.per.sec, Orbit.Uncertainity, Jupiter.Tisserand.Invariant", x = "Value", y = "Frequency") +
  scale_fill_manual(values = rainbow(length(unique(Ast_Subset_long_2$Variable))) ) +
  scale_color_manual(values = "black") +
  theme_minimal() +
  theme(legend.position = "right")


```
```{r, include=TRUE, echo=TRUE, results='asis'}

# Create a histogram for 'Eccentricity', 'Semi.Major.Axis', and 'Inclination'
selected_columns_3 <- Ast_Subset[c('Eccentricity', 'Semi.Major.Axis', 'Inclination')]

# Reshape the data into long format
Ast_Subset_long_3 <- pivot_longer(selected_columns_3, 
                                cols = everything(),
                                names_to = "Variable", values_to = "Value")

# Create the histogram
ggplot(Ast_Subset_long_3, aes(x = Value, fill = Variable, color = "black")) +
  geom_histogram(binwidth = 0.1, alpha = 0.7, position = "identity", show.legend = FALSE) +
  facet_wrap(~Variable, scales = "free") +
  labs(title = "Histogram of Eccentricity, Semi.Major.Axis, Inclination", x = "Value", y = "Frequency") +
  scale_fill_manual(values = rainbow(length(unique(Ast_Subset_long_3$Variable))) ) +
  scale_color_manual(values = "black") +
  theme_minimal() +
  theme(legend.position = "right")



```

```{r, include=TRUE, echo=TRUE, results='asis'}
# Create a histogram for 'Perihelion.Distance', 'Aphelion.Dist', 'Perihelion.Time', 'Mean.Motion'
selected_columns_4 <- Ast_Subset[c('Perihelion.Distance', 'Aphelion.Dist', 'Perihelion.Time', 'Mean.Motion')]

# Reshape the data into long format
Ast_Subset_long_4 <- pivot_longer(selected_columns_4, 
                                cols = everything(),
                                names_to = "Variable", values_to = "Value")

# Create the histogram
ggplot(Ast_Subset_long_4, aes(x = Value, fill = Variable, color = "black")) +
  geom_histogram(binwidth = 0.1, alpha = 0.7, position = "identity", show.legend = FALSE) +
  facet_wrap(~Variable, scales = "free") +
  labs(title = "Histogram of Perihelion.Distance, Aphelion.Dist, Perihelion.Time, Mean.Motion", x = "Value", y = "Frequency") +
  scale_fill_manual(values = rainbow(length(unique(Ast_Subset_long_4$Variable))) ) +
  scale_color_manual(values = "black") +
  theme_minimal() +
  theme(legend.position = "right")


```


```{r, include=TRUE, echo=TRUE, results='asis'}

# Create a pie chart for a binary categorical variable
counts <- table(Ast_Subset$Hazardous)

# Assign labels to the counts
labels <- c("Not Hazardous", "Hazardous")

# Create the pie chart
pie(counts, labels = labels, main = "Distribution of Asteroids by Hazardous Status")

```
When going to the distributions of the hazardous column. It is clearly visible that the Non-Hazardous Asteroids are more compared to Hazardous.
The data is Asymmetrical. 
Considering the 3000 minimum rows rule, leveling/making data symmetrical is not a viable option right now. 






** Null Hypothesis **: There is no significant difference in perihelion distance for hazardous and non-hazardous asteroids.
** Alternate Hypothesis **: There is significant difference in perihelion distance for hazardous and non-hazardous asteroids. 
```{r Q1}

ggplot(Ast_Subset, aes(Hazardous , Perihelion.Distance, group = Hazardous , fill = Hazardous)) + geom_boxplot() + labs(title="Boxplot of Perihelion Distance ")

ggplot(Ast_Subset, aes(Hazardous , Aphelion.Dist, group = Hazardous, fill = Hazardous)) + geom_boxplot() +labs(title="Boxplot of Aphelion Distance ")

Per_Hazardous <- Ast_Subset$Perihelion.Distance[Ast_Subset$Hazardous == 1]
Per_Non_Hazardous <- Ast_Subset$Perihelion.Distance[Ast_Subset$Hazardous == 0]

Aph_Hazardous <- Ast_Subset$Aphelion.Dist[Ast_Subset$Hazardous == 1]
Aph_Non_Hazardous <- Ast_Subset$Aphelion.Dist[Ast_Subset$Hazardous == 0]



test_per <- t.test(Per_Hazardous, Per_Non_Hazardous)
test_aph <- t.test(Aph_Hazardous, Aph_Non_Hazardous)

test_per
test_aph

```
Observation: 

Perihelion Distance: There is an observable trend where hazardous asteroids tend to exhibit smaller perihelion distances when compared to their non-hazardous counterparts.

Aphelion Distance: A subtle yet statistically significant variation emerges, with asteroids possessing higher aphelion distances demonstrating a slightly increased likelihood of being classified as hazardous. Nevertheless, it's important to note that the means of the two groups remain closely aligned. Thus, we cannot definitively attribute higher aphelion distance as the sole determinant of an asteroid's hazardous classification.


```{r, include=TRUE, echo=TRUE, results='show'}

# Install the following package (if not already)
# install.packages("randomForest")

library(randomForest)

# Splitting the dataset into predictors (X) excluding the target variable
X <- select(Ast_Subset, -c(Hazardous))
Y <- Ast_raw$Hazardous

# Fitting a Random Forest model to determine feature importance
set.seed(123)  # Setting a seed for reproducibility
rf_model <- randomForest(X, Y, ntree = 1000)

# Getting the feature importance
importance <- importance(rf_model)

# Printing importance
print(importance)


library(ggplot2)

# Get feature importance as a data frame
importance_df <- as.data.frame(importance(rf_model))

# Create a custom feature importance plot
ggplot(importance_df, aes(x = reorder(rownames(importance_df), -MeanDecreaseGini), y = MeanDecreaseGini)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(x = "Features", y = "Mean Decrease in Gini Index") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  ggtitle("Feature Importance in Asteroid Hazard Prediction")

```

\*\* From the above outputs we can infer the following:\*\*

Absolute Magnitude: This feature holds the highest importance score of 104.07, signifying its significant influence on the model's capability to differentiate between hazardous and non-hazardous asteroids. In other words, the brightness of the asteroid, represented by its absolute magnitude, plays a crucial role in hazard classification.

Est Dia in KM min and Est Dia in KM max: These two features also possess substantial importance scores, 99.01 and 110.43 respectively. This indicates that the estimated diameter of the asteroid in kilometers is of paramount importance when assessing whether an asteroid is hazardous or not.

Relative Velocity km per sec: While still important, this feature has a comparatively lower importance score of 16.29. It suggests that the asteroid's velocity, although not as critical as size and magnitude, does contribute to the model's ability to make predictions regarding hazard levels.

Orbiting Body: This feature's importance score is 0.00, implying that it does not impact the model's hazard classification. It may be a candidate for removal from the feature set since it has no discernible effect on the predictions.

Orbit Uncertainty: With a moderate importance score of 40.64, this feature contributes to determining hazard levels. It suggests that the degree of uncertainty in an asteroid's orbit is a relevant factor in classification.

Minimum Orbit Intersection: This feature carries the highest importance score of 469.03, indicating its central role in classifying asteroids as hazardous or not. The closer an asteroid's orbit intersects with others, the more it influences the hazard classification.

Jupiter Tisserand Invariant, Epoch Osculation, Eccentricity, Semi Major Axis, Inclination, Asc Node Longitude, and Perihelion Distance: These features exhibit varying importance scores. While they may not be as influential as absolute magnitude or asteroid size, they still contribute to the model's predictive ability to some extent. These parameters play a role in shaping the model's understanding of asteroid hazard.




## Smart Question:PratiKsha Dange

**Is there any significant difference in the orbit uncertainty, Mean Motion, and inclination with a change in Perihelion Distance?** <br> - Test: ANOVA Test .<br> - Reason: Here we are examining the relationship between orbit uncertainty, mean motion, and inclination (which are likely numeric or continuous variables) and perihelion distance (also a numeric variable). <br>

```{r , include=TRUE, echo=TRUE, results='show'}

# Perform ANOVA for 'OrbitUncertainty' with 'PerihelionDistance'
orbitU_perihelionDist_anova <- aov(`Orbit.Uncertainity` ~ `Perihelion.Distance`, data = Ast_raw)
summary(orbitU_perihelionDist_anova)

# Perform ANOVA for 'MeanMotion' with 'PerihelionDistance'
meanM_perihelionDist_anova <- aov(`Mean.Motion` ~ `Perihelion.Distance`, data = Ast_raw)
summary(meanM_perihelionDist_anova)

# Perform ANOVA for 'Inclination' with 'PerihelionDistance'
inclination_perihelionDist_anova <- aov(Inclination ~ `Perihelion.Distance`, data = Ast_raw)
summary(inclination_perihelionDist_anova)

```

**Test 1 - Orbit Uncertainty vs. Perihelion Distance:**

-   Df (Degrees of Freedom): There is 1 degree of freedom associated with Perihelion Distance, and 3690 degrees of freedom for residuals.
-   Sum Sq (Sum of Squares): The sum of squares for Perihelion Distance is 381, and for residuals, it's 35756.
-   Mean Sq (Mean Square): The mean square for Perihelion Distance is 381.
-   F value: The F-statistic is 39.4.
-   Pr(\>F): The p-value is approximately 3.9e-10, which is extremely small.

**Interpretation:** In this test, the p-value (Pr(\>F)) is very small (3.9e-10), which indicates that there is a statistically significant difference in "Orbit Uncertainty" with a change in "Perihelion Distance." This suggests that "Perihelion Distance" has a significant impact on "Orbit Uncertainty."

**Test 2 - Mean Motion vs. Perihelion Distance:**

-   Df: 1 degree of freedom for Perihelion Distance and 3690 degrees of freedom for residuals.
-   Sum Sq: The sum of squares for Perihelion Distance is 133, and for residuals, it's 276.
-   Mean Sq: The mean square for Perihelion Distance is 133.
-   F value: The F-statistic is 1777.
-   Pr(\>F): The p-value is less than 2e-16, which is extremely small.

**Interpretation:** In this test, the p-value is also very small (much less than 0.001), indicating a highly significant difference in "Mean Motion" with a change in "Perihelion Distance." Thus, "Perihelion Distance" significantly affects "Mean Motion."

**Test 3 - Inclination vs. Perihelion Distance:**

-   Df: 1 degree of freedom for Perihelion Distance and 3690 degrees of freedom for residuals.
-   Sum Sq: The sum of squares for Perihelion Distance is 1681, and for residuals, it's 447526.
-   Mean Sq: The mean square for Perihelion Distance is 1681.
-   F value: The F-statistic is 13.9.
-   Pr(\>F): The p-value is 2e-04, which is relatively small.

**Interpretation:** In this test, the p-value (Pr(\>F)) is smaller than 0.05, indicating a significant difference in "Inclination" concerning changes in "Perihelion Distance." It implies that "Perihelion Distance" has a statistically significant effect on "Inclination," though the significance is not as strong as in the previous tests.

In summary, based on these ANOVA tests, it appears that "Perihelion Distance" has a significant impact on "Orbit Uncertainty," "Mean Motion," and "Inclination," with "Mean Motion" having the most substantial effect, followed by "Orbit Uncertainty" and then "Inclination." The p-values for all three tests suggest that the relationships are statistically significant.





