---
title: "Evaluating Asteroid Characteristics and Predicting Hazard Levels Using NASA's Asteroid Classification Dataset"
authors: "Vishal Bakshi, Pratiksha Dange, Sudanshu Dotel, Qibin Huang"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes      
---
    
```{r init, include=FALSE}
# some of common options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
library(ezids)
# knitr::opts_chunk$set(warning = F, results = "markup", message = F)
knitr::opts_chunk$set(warning = F, results = "hide", message = F)
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3)  
# ‘scipen’: integer. A penalty to be applied when deciding to print numeric values in fixed or exponential notation.  Positive values bias towards fixed and negative towards scientific notation: fixed notation will be preferred unless it is more than ‘scipen’ digits wider.
# use scipen=999 to prevent scientific notation at all times
```

```{css, include=FALSE}
.columns {display: flex;}
h1 {color: #87CEFA}
h2 {color:blue}
```
## Column Definitions:

**1. Neo Reference ID :** ID for the Asteroid<br> **2. Name :** Name of the Asteroid <br> **3. Absolute Magnitude:** It tells about the brightness of the star i.e., Bright star has low magnitude and Dim star has high magnitude <br> **4. Est Dia in KM(min) :** This column tells us the estimated minimum size of the asteroid in terms of KM <br> **5. Est Dia in KM(max) :** This column tells us the estimated maximum size of the asteroid in terms of KM <br> **6. Close Approach Date :** The date when the asteroid was very close to earth's atmosphere <br> **7. Epoch Date Close Approach :** A related date about the asteroid's close approach <br> **8. Relative Velocity km per sec :** The velocity of the asteroid <br> **9. Miss Dist.(Astronomical) :** It tells us how far the asteroid came close to Earth, measured in astronomical units <br> **10. Miss Dist.(lunar) :** The distance in terms of the Moon's distance from Earth <br> **11. Miss Dist.(kilometers) :** The closest approach of the asteroid to Earth in kilometers <br> **12. Miss Dist.(miles) :** The closest approach in miles <br> **13. Orbiting Body :** Tells us the orbiting body of the celestial body <br> **14. Orbit ID :** An ID for the asteroid's orbit <br> **15. Orbit Determination Date:** The date when the asteroid's orbit was calculated <br> **16. Orbit Uncertainity Minimum :** A measure of the uncertainty in the asteroid's orbit<br> **17. Orbit Intersection:** This column tells about where the asteroid's orbit crosses <br> **18. Jupiter Tisserand Invariant :** The JTI is the planet jupyter force/pull of the celestial bodies surrounding them. The least JTI is on the celestial bodies which is far from the jupiter <br> **19. Epoch Osculation :** A specific date related to the asteroid<br> **20. Eccentricity :** Decides the shape of the orbit, i.e., 0 \< E \< 1 : Ellispe, E = 1 : Parabola, E \> 1 : Hyperbola <br> **21. Semi Major Axis :** It tells us about hoow big the asteroid's orbit is <br> **22. Inclination :** The tilt of the asteroid's orbit <br> **23. Asc Node Longitude :** Where the asteroid's orbit crosses a reference plane <br> **24. Orbital Period :** This column tells us about how long it takes for the asteroid to complete one orbit <br> **25. Perihelion Distance :** This column tells us about how close the asteroid gets to the Sun during it's orbit <br> **26. Perihelion Arg :** A measure related to the direction of the asteroid's orbit <br> **27. Aphelion Dist :** This column tells us about how far the asteroid is from the Sun during it's orbit <br> **28. Perihelion Time :** The time when the asteroid is closest to the Sun <br> **29. Mean Anomaly :** A measure of where the asteroid is in its orbit <br> **30. Mean Motion :** Information about how the asteroid moves in it's orbit <br> **31. Equinox :** The reference point for the orbital information <br> **32. Hazardous:** Target variable, tells us if above variables is affecting the asteroid being hazardous to earth. If it's marked as 1, it's considered hazardous; if it's 0, it's not considered dangerous <br>

## Importing Hazardous/Not Asteroid Classification

```{r, include=TRUE, echo=TRUE, results='show'}
current_directory <- getwd()
data_path <- "Datasets/Asteroid_Hazard_Classification.csv"
file_path <- file.path(dirname(current_directory), data_path)
Ast_raw <- data.frame(read.csv(file_path))
```    

```{r, include=TRUE, echo=TRUE, results='show'}
library(dplyr)
Ast_raw <- Ast_raw %>%
mutate(Hazardous = as.integer(Hazardous))#(1 is True, 0 is False)
Ast_raw$Hazardous <- as.factor(Ast_raw$Hazardous)
str(Ast_raw)
```

```{r, include=TRUE, echo=TRUE, results='show'}
selected_columns <- c('Neo.Reference.ID', 'Name', 'Absolute.Magnitude', 'Est.Dia.in.KM.min.', 'Est.Dia.in.KM.max.', 'Relative.Velocity.km.per.sec', 'Orbit.Uncertainity', 'Minimum.Orbit.Intersection', 'Jupiter.Tisserand.Invariant', 'Epoch.Osculation', 'Eccentricity', 'Semi.Major.Axis', 'Inclination', 'Asc.Node.Longitude', 'Perihelion.Distance', 'Perihelion.Arg', 'Aphelion.Dist', 'Perihelion.Time', 'Mean.Anomaly', 'Mean.Motion', 'Hazardous')

Ast_Subset <- subset(Ast_raw, select = selected_columns)
head(Ast_Subset)

```
## Histogram plots of Absolute Magnitude, Diameter in Kilo Meters, Relative Velocity, Mean Motion, Aphelion Distance,inclination,  Perihelion Distance
```{r}
library(ggplot2)

# Assuming you have a data frame called Ast_Subset
# Select the columns you want to display in the histogram
selected_columns <- Ast_Subset[c('Absolute.Magnitude', "Est.Dia.in.KM.min.", "Est.Dia.in.KM.max.", 
                                 "Relative.Velocity.km.per.sec", "Jupiter.Tisserand.Invariant", 
                                 "Inclination", "Perihelion.Distance", "Aphelion.Dist", "Mean.Motion")]

# Reshape the data into long format
library(tidyr)
Ast_Subset_long <- pivot_longer(selected_columns, 
                                cols = everything(),
                                names_to = "Variable", values_to = "Value")

# Create a histogram with different colors for each variable
ggplot(Ast_Subset_long, aes(x = Value, fill = Variable)) +
  geom_histogram(bins = 30, alpha = 0.5) +
  facet_wrap(~Variable, scales = "free") +
  labs(title = "Histogram of Asteroid Variables") +
  scale_fill_manual(values = rainbow(length(unique(Ast_Subset_long$Variable))))

```   
```{r}

ggplot(Ast_Subset, aes(x=Hazardous, fill = Hazardous)) + geom_bar() + labs(title="Bar plot of Hazard Columns")

```

** Null Hypothesis **: There is no significant difference in perihelion distance for hazardous and non-hazardous asteroids.
Alternate Hypothesis: There is significant difference in perihelion distance for hazardous and non-hazardous asteroids. 
```{r Q1}

ggplot(Ast_Subset, aes(Hazardous , Perihelion.Distance, group = Hazardous , fill = Hazardous)) + geom_boxplot() + labs(title="Boxplot of Perihelion Distance ")

ggplot(Ast_Subset, aes(Hazardous , Aphelion.Dist, group = Hazardous, fill = Hazardous)) + geom_boxplot() +labs(title="Boxplot of Aphelion Distance ")

Per_Hazardous <- Ast_Subset$Perihelion.Distance[Ast_Subset$Hazardous == 1]
Per_Non_Hazardous <- Ast_Subset$Perihelion.Distance[Ast_Subset$Hazardous == 0]

Aph_Hazardous <- Ast_Subset$Aphelion.Dist[Ast_Subset$Hazardous == 1]
Aph_Non_Hazardous <- Ast_Subset$Aphelion.Dist[Ast_Subset$Hazardous == 0]



test_per <- t.test(Per_Hazardous, Per_Non_Hazardous)
test_aph <- t.test(Aph_Hazardous, Aph_Non_Hazardous)

test_per
test_aph

```
Observation: 

Perihelion Distance: There is an observable trend where hazardous asteroids tend to exhibit smaller perihelion distances when compared to their non-hazardous counterparts.

Aphelion Distance: A subtle yet statistically significant variation emerges, with asteroids possessing higher aphelion distances demonstrating a slightly increased likelihood of being classified as hazardous. Nevertheless, it's important to note that the means of the two groups remain closely aligned. Thus, we cannot definitively attribute higher aphelion distance as the sole determinant of an asteroid's hazardous classification.

```{r}
#To generate the correlation plot between the predictor variables

# Install and load the required packages
# Install if not already installed
# install.packages("ggplot2")
# install.packages("heatmaply")
library(ggplot2)
library(heatmaply)
library(RColorBrewer)  # Explicitly load RColorBrewer

# Converting the dataset to a data frame (if not already done)
Ast_Subset <- as.data.frame(Ast_Subset)

# Exclude the "Name" and "Neo.Reference.ID" columns
Ast_Subset <- Ast_Subset[, !(names(Ast_Subset) %in% c("Name", "Neo.Reference.ID"))]

# Selecting only the numeric columns from your subset
numeric_columns <- Ast_Subset[, sapply(Ast_Subset, is.numeric)]

# Computing the correlation matrix
correlation_matrix <- cor(numeric_columns)

# Create a correlation heatmap with the "RdYlBu" color palette from RColorBrewer
heatmaply(correlation_matrix, 
          col = colorRampPalette(brewer.pal(11, "RdYlBu"))(256),  # Choose the "RdYlBu" palette
          fontsize_col = 10,   # Adjust font size
          width = 800,         # Adjust plot width
          height = 600,        # Adjust plot height
          main = "Correlation Heatmap of Predictor Variables")
```







```{r, include=TRUE, echo=TRUE, results='show'}

# Install the following package (if not already)
# install.packages("randomForest")

library(randomForest)

# Splitting the dataset into predictors (X) excluding the target variable
X <- select(Ast_Subset, -c(Hazardous))
Y <- Ast_raw$Hazardous

# Fitting a Random Forest model to determine feature importance
set.seed(123)  # Setting a seed for reproducibility
rf_model <- randomForest(X, Y, ntree = 1000)

# Getting the feature importance
importance <- importance(rf_model)

# Printing importance
print(importance)


library(ggplot2)

# Get feature importance as a data frame
importance_df <- as.data.frame(importance(rf_model))

# Create a custom feature importance plot
ggplot(importance_df, aes(x = reorder(rownames(importance_df), -MeanDecreaseGini), y = MeanDecreaseGini)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(x = "Features", y = "Mean Decrease in Gini Index") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  ggtitle("Feature Importance in Asteroid Hazard Prediction")

```

\*\* From the above outputs we can infer the following:\*\*

Absolute Magnitude: This feature holds the highest importance score of 104.07, signifying its significant influence on the model's capability to differentiate between hazardous and non-hazardous asteroids. In other words, the brightness of the asteroid, represented by its absolute magnitude, plays a crucial role in hazard classification.

Est Dia in KM min and Est Dia in KM max: These two features also possess substantial importance scores, 99.01 and 110.43 respectively. This indicates that the estimated diameter of the asteroid in kilometers is of paramount importance when assessing whether an asteroid is hazardous or not.

Relative Velocity km per sec: While still important, this feature has a comparatively lower importance score of 16.29. It suggests that the asteroid's velocity, although not as critical as size and magnitude, does contribute to the model's ability to make predictions regarding hazard levels.

Orbiting Body: This feature's importance score is 0.00, implying that it does not impact the model's hazard classification. It may be a candidate for removal from the feature set since it has no discernible effect on the predictions.

Orbit Uncertainty: With a moderate importance score of 40.64, this feature contributes to determining hazard levels. It suggests that the degree of uncertainty in an asteroid's orbit is a relevant factor in classification.

Minimum Orbit Intersection: This feature carries the highest importance score of 469.03, indicating its central role in classifying asteroids as hazardous or not. The closer an asteroid's orbit intersects with others, the more it influences the hazard classification.

Jupiter Tisserand Invariant, Epoch Osculation, Eccentricity, Semi Major Axis, Inclination, Asc Node Longitude, and Perihelion Distance: These features exhibit varying importance scores. While they may not be as influential as absolute magnitude or asteroid size, they still contribute to the model's predictive ability to some extent. These parameters play a role in shaping the model's understanding of asteroid hazard.


## Smart Question:PratiKsha Dange

**Is there any significant difference in the orbit uncertainty, Mean Motion, and inclination with a change in Perihelion Distance?** <br> - Test: ANOVA Test .<br> - Reason: Here we are examining the relationship between orbit uncertainty, mean motion, and inclination (which are likely numeric or continuous variables) and perihelion distance (also a numeric variable). <br>

```{r Q1, include=TRUE, echo=TRUE, results='show'}

# Perform ANOVA for 'OrbitUncertainty' with 'PerihelionDistance'
orbitU_perihelionDist_anova <- aov(`Orbit.Uncertainity` ~ `Perihelion.Distance`, data                                = Ast_raw)
summary(orbitU_perihelionDist_anova)

# Perform ANOVA for 'MeanMotion' with 'PerihelionDistance'
meanM_perihelionDist_anova <- aov(`Mean.Motion` ~ `Perihelion.Distance`, data =                                        Ast_raw)
summary(meanM_perihelionDist_anova)

# Perform ANOVA for 'Inclination' with 'PerihelionDistance'
inclination_perihelionDist_anova <- aov(Inclination ~ `Perihelion.Distance`, data =                                       Ast_raw)
summary(inclination_perihelionDist_anova)

```

**Test 1 - Orbit Uncertainty vs. Perihelion Distance:**

-   Df (Degrees of Freedom): There is 1 degree of freedom associated with Perihelion Distance, and 3690 degrees of freedom for residuals.
-   Sum Sq (Sum of Squares): The sum of squares for Perihelion Distance is 381, and for residuals, it's 35756.
-   Mean Sq (Mean Square): The mean square for Perihelion Distance is 381.
-   F value: The F-statistic is 39.4.
-   Pr(\>F): The p-value is approximately 3.9e-10, which is extremely small.

**Interpretation:** In this test, the p-value (Pr(\>F)) is very small (3.9e-10), which indicates that there is a statistically significant difference in "Orbit Uncertainty" with a change in "Perihelion Distance." This suggests that "Perihelion Distance" has a significant impact on "Orbit Uncertainty."

**Test 2 - Mean Motion vs. Perihelion Distance:**

-   Df: 1 degree of freedom for Perihelion Distance and 3690 degrees of freedom for residuals.
-   Sum Sq: The sum of squares for Perihelion Distance is 133, and for residuals, it's 276.
-   Mean Sq: The mean square for Perihelion Distance is 133.
-   F value: The F-statistic is 1777.
-   Pr(\>F): The p-value is less than 2e-16, which is extremely small.

**Interpretation:** In this test, the p-value is also very small (much less than 0.001), indicating a highly significant difference in "Mean Motion" with a change in "Perihelion Distance." Thus, "Perihelion Distance" significantly affects "Mean Motion."

**Test 3 - Inclination vs. Perihelion Distance:**

-   Df: 1 degree of freedom for Perihelion Distance and 3690 degrees of freedom for residuals.
-   Sum Sq: The sum of squares for Perihelion Distance is 1681, and for residuals, it's 447526.
-   Mean Sq: The mean square for Perihelion Distance is 1681.
-   F value: The F-statistic is 13.9.
-   Pr(\>F): The p-value is 2e-04, which is relatively small.

**Interpretation:** In this test, the p-value (Pr(\>F)) is smaller than 0.05, indicating a significant difference in "Inclination" concerning changes in "Perihelion Distance." It implies that "Perihelion Distance" has a statistically significant effect on "Inclination," though the significance is not as strong as in the previous tests.

In summary, based on these ANOVA tests, it appears that "Perihelion Distance" has a significant impact on "Orbit Uncertainty," "Mean Motion," and "Inclination," with "Mean Motion" having the most substantial effect, followed by "Orbit Uncertainty" and then "Inclination." The p-values for all three tests suggest that the relationships are statistically significant.



```{r, echo=TRUE, results='show'}
ggplot(Ast_Subset, aes(x = Perihelion.Distance, y = Hazardous)) +
  geom_point(aes(size=Perihelion.Distance), color = "red") +
  labs(x = "Perihelion Distance", y = "Hazardous") +
  ggtitle("Scatter Plot of Hazardous vs. Perihelion Distance")

ggplot(Ast_Subset, aes(x=Hazardous, y = Perihelion.Distance, fill = Hazardous)) + geom_violin(fill = "red") + labs(x = "Hazardous", y = "Perihelion Distance") +
  scale_fill_manual(values = c("Not Hazardous" = "blue", "Hazardous" = "red")) + # Define custom colors
  ggtitle("Violin Plot of Hazardous vs. Perihelion Distance")
```


```{r}


```
