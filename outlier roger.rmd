---
title: "Evaluating Asteroid Characteristics and Predicting Hazard Levels Using NASA's Asteroid Classification Dataset"
authors: "Vishal Bakshi, Pratiksha Dange, Sudanshu Dotel, Qibin Huang"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
---

```{r init, include=FALSE}
# some of common options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
library(ezids)
# knitr::opts_chunk$set(warning = F, results = "markup", message = F)
knitr::opts_chunk$set(warning = F, results = "hide", message = F)
options(scientific=T, digits = 3) 
# options(scipen=9, digits = 3)  
# ‘scipen’: integer. A penalty to be applied when deciding to print numeric values in fixed or exponential notation.  Positive values bias towards fixed and negative towards scientific notation: fixed notation will be preferred unless it is more than ‘scipen’ digits wider.
# use scipen=999 to prevent scientific notation at all times
```

```{css, include=FALSE}
.columns {display: flex;}
h1 {color: #87CEFA}
h2 {color:blue}
```

## Column Definitions:

**1.  Neo Reference ID :** ID for the Asteroid<br>
**2.  Name :** Name of the Asteroid <br>
**3.  Absolute Magnitude:** It tells about the brightness of the star i.e., Bright star has low magnitude and Dim star has high magnitude <br>
**4.  Est Dia in KM(min) :** This column tells us the estimated minimum size of the asteroid in terms of KM <br>
**5.  Est Dia in KM(max) :** This column tells us the estimated maximum size of the asteroid in terms of KM <br>
**6.  Close Approach Date :** The date when the asteroid was very close to earth's atmosphere <br>
**7.  Epoch Date Close Approach :** A related date about the asteroid's close approach <br>
**8.  Relative Velocity km per sec :** The velocity of the asteroid <br>
**9.  Miss Dist.(Astronomical) :** It tells us how far the asteroid came close to Earth, measured in astronomical units <br>
**10. Miss Dist.(lunar) :** The distance in terms of the Moon's distance from Earth <br>
**11. Miss Dist.(kilometers) :** The closest approach of the asteroid to Earth in kilometers <br>
**12. Miss Dist.(miles) :** The closest approach in miles <br>
**13. Orbiting Body :** Tells us the orbiting body of the celestial body <br>
**14. Orbit ID :** An ID for the asteroid's orbit <br>
**15. Orbit Determination Date:** The date when the asteroid's orbit was calculated <br>
**16. Orbit Uncertainity Minimum :** A measure of the uncertainty in the asteroid's orbit<br>
**17. Orbit Intersection:** This column tells about where the asteroid's orbit crosses <br>
**18. Jupiter Tisserand Invariant :** The JTI is the planet jupyter force/pull of the celestial bodies surrounding them. The least JTI is on the celestial bodies which is far from the jupiter <br>
**19. Epoch Osculation :** A specific date related to the asteroid<br>
**20. Eccentricity :** Decides the shape of the orbit, i.e., 0 \< E \< 1 : Ellispe, E = 1 : Parabola, E \> 1 : Hyperbola <br>
**21. Semi Major Axis :** It tells us about hoow big the asteroid's orbit is <br>
**22. Inclination :** The tilt of the asteroid's orbit <br>
**23. Asc Node Longitude :** Where the asteroid's orbit crosses a reference plane <br>
**24. Orbital Period :** This column tells us about how long it takes for the asteroid to complete one orbit <br>
**25. Perihelion Distance :** This column tells us about how close the asteroid gets to the Sun during it's orbit <br>
**26. Perihelion Arg :** A measure related to the direction of the asteroid's orbit <br>
**27. Aphelion Dist :** This column tells us about how far the asteroid is from the Sun during it's orbit <br>
**28. Perihelion Time :** The time when the asteroid is closest to the Sun <br>
**29. Mean Anomaly :** A measure of where the asteroid is in its orbit <br>
**30. Mean Motion :** Information about how the asteroid moves in it's orbit <br>
**31. Equinox :** The reference point for the orbital information <br>
**32. Hazardous:** Target variable, tells us if above variables is affecting the asteroid being hazardous to earth. If it's marked as 1, it's considered hazardous; if it's 0, it's not considered dangerous <br>

## Importing Hazardous/Not Asteroid Classification


```{r, include=TRUE, echo=TRUE, results='show'}
current_directory <- getwd()
data_path <- "Datasets/Astroid_Hazard_Classification.csv"
file_path <- file.path(dirname(current_directory), data_path)
Ast_raw <- data.frame(read.csv(file_path))
```

```{r, include=TRUE, echo=TRUE, results='show'}
library(dplyr)
Ast_raw <- Ast_raw %>%
mutate(Hazardous = as.integer(Hazardous))#(1 is True, 0 is False)
head(Ast_raw[,0:5])
```



```{r, include=TRUE, echo=TRUE, results='show'}
selected_columns <- c('Neo.Reference.ID', 'Name', 'Absolute.Magnitude', 'Est.Dia.in.KM.min.', 'Est.Dia.in.KM.max.', 'Relative.Velocity.km.per.sec', 'Orbit.Uncertainity', 'Minimum.Orbit.Intersection', 'Jupiter.Tisserand.Invariant', 'Epoch.Osculation', 'Eccentricity', 'Semi.Major.Axis', 'Inclination', 'Asc.Node.Longitude', 'Perihelion.Distance', 'Perihelion.Arg', 'Aphelion.Dist', 'Perihelion.Time', 'Mean.Anomaly', 'Mean.Motion', 'Hazardous')
Ast_Subset <- subset(Ast_raw, select = selected_columns)

head(Ast_Subset)

```

```{r, include=TRUE, echo=TRUE, results='show'}

#To generate the correlation plot between the predictor variables

# Loading the required packages
library(corrplot)
library(dplyr)

# Converting the dataset to a data frame
Ast_Subset <- as.data.frame(Ast_Subset)

# Selecting only the numeric columns from your subset
numeric_columns <- Ast_Subset[, sapply(Ast_Subset, is.numeric)]

# Computing the correlation matrix
correlation_matrix <- cor(numeric_columns)

# Creating a correlation plot
corrplot(correlation_matrix, method = "color", type = "lower", order = "hclust", tl.cex = 0.7)


```

```{r, include=TRUE, echo=TRUE, results='show'}

#To generate feature importance

#Install the following  package (if not already)
install.packages("randomForest") 

library(randomForest)

# Splitting the dataset into predictors (X) and the target variable (Y)
X <- select(Ast_Subset, -c(Neo.Reference.ID, Name))
Y <- as.factor(Ast_raw$Hazardous)

# Fitting a Random Forest model to determine feature importance
set.seed(123)  # Setting a seed for reproducibility
rf_model <- randomForest(X, Y, ntree = 1000)

# Getting the feature importance
importance <- importance(rf_model)

# Printing importance
print(importance)
varImpPlot(rf_model)

```
** From the above outputs we can infer the following:**

Absolute Magnitude: This feature holds the highest importance score of 104.07, signifying its significant influence on the model's capability to differentiate between hazardous and non-hazardous asteroids. In other words, the brightness of the asteroid, represented by its absolute magnitude, plays a crucial role in hazard classification.

Est Dia in KM min and Est Dia in KM max: These two features also possess substantial importance scores, 99.01 and 110.43 respectively. This indicates that the estimated diameter of the asteroid in kilometers is of paramount importance when assessing whether an asteroid is hazardous or not.

Relative Velocity km per sec: While still important, this feature has a comparatively lower importance score of 16.29. It suggests that the asteroid's velocity, although not as critical as size and magnitude, does contribute to the model's ability to make predictions regarding hazard levels.

Orbiting Body: This feature's importance score is 0.00, implying that it does not impact the model's hazard classification. It may be a candidate for removal from the feature set since it has no discernible effect on the predictions.

Orbit Uncertainty: With a moderate importance score of 40.64, this feature contributes to determining hazard levels. It suggests that the degree of uncertainty in an asteroid's orbit is a relevant factor in classification.

Minimum Orbit Intersection: This feature carries the highest importance score of 469.03, indicating its central role in classifying asteroids as hazardous or not. The closer an asteroid's orbit intersects with others, the more it influences the hazard classification.

Jupiter Tisserand Invariant, Epoch Osculation, Eccentricity, Semi Major Axis, Inclination, Asc Node Longitude, and Perihelion Distance: These features exhibit varying importance scores. While they may not be as influential as absolute magnitude or asteroid size, they still contribute to the model's predictive ability to some extent. These parameters play a role in shaping the model's understanding of asteroid hazard.


```{r}

Ast_Subset$Perihelion_Category <- cut(Ast_Subset$Perihelion.Distance, breaks = c(0, 0.1, 0.2, Inf), labels = c("Near", "Intermediate", "Far"))
Ast_Subset$Aphelion_Category <- cut(Ast_Subset$Aphelion.Dist, breaks = c(0, 0.5, 1, Inf), labels = c("Near", "Intermediate", "Far"))

contingency_table <- table(Ast_Subset$Hazardous,Ast_Subset$Perihelion_Category, Ast_Subset$Aphelion_Category)
chi_square_result <- chisq.test(contingency_table)
chi_square_result

Ast_Subset$Perihelion_Category <- cut(Ast_Subset$Perihelion.Distance, breaks = c(0, 0.1, 0.2, Inf), labels = c("Near", "Intermediate", "Far"))
Ast_Subset$Aphelion_Category <- cut(Ast_Subset$Aphelion.Dist, breaks = c(0, 0.5, 1, Inf), labels = c("Near", "Intermediate", "Far"))

logistic_model <- glm(Hazardous ~ Perihelion_Category + Aphelion_Category, data = Ast_Subset, family = binomial)
summary(logistic_model)


# Assuming you have a dataframe 'Ast_Subset' with the relevant columns (Hazardous, Perihelion.Distance, Aphelion.Dist)

# Create categories for Perihelion Distance and Aphelion Distance
Ast_Subset$Perihelion_Category <- cut(Ast_Subset$Perihelion.Distance, breaks = c(0, 0.1, 0.2, Inf), labels = c("Near", "Intermediate", "Far"))
Ast_Subset$Aphelion_Category <- cut(Ast_Subset$Aphelion.Dist, breaks = c(0, 0.5, 1, Inf), labels = c("Near", "Intermediate", "Far"))

# Create a contingency table
contingency_table <- table(Ast_Subset$Perihelion_Category, Ast_Subset$Aphelion_Category)

# Perform the Chi-Square Test for Independence
chi_square_result <- chisq.test(contingency_table)

# View the results
print(chi_square_result)






```
**Question 4: Is there any significant difference in the orbit uncertainty, Mean Motion, and inclination with a change in Perihelion Distance? (Chi-Square Test)**
   - Test: Chi-Square Test or other suitable test.
   - Reason: To explore the relationship between orbital parameters (orbit uncertainty, Mean Motion, inclination) and Perihelion Distance. 


```{r}

Ast_Subset$Mean_Motion_Category <- cut(Ast_Subset$Mean.Motion, 
  breaks = c(min(Ast_Subset$Mean.Motion), 
             quantile(Ast_Subset$Mean.Motion, 1/3), 
             quantile(Ast_Subset$Mean.Motion, 2/3), 
             max(Ast_Subset$Mean.Motion)), 
  labels = c("Low", "Medium", "High"))


contingency_table <- table(Ast_Subset$Mean_Motion_Category, Ast_Subset$Perihelion_Category)

# Perform the Chi-Square Test 
chi_square_result1_Mean<- chisq.test(contingency_table)

print(chi_square_result1)

anova_model <- aov(Mean.Motion ~ Perihelion.Distance, data = Ast_Subset)

summary(anova_model)

# Fit an ANOVA model
anova_model <- aov(Inclination ~ Perihelion.Distance, data = Ast_Subset)

summary(anova_model)











```

```{r}

# Assuming you have a dataframe 'Ast_Subset' with the relevant columns (Est Dia in KM min, Est Dia in KM max)

# Create histograms for Est Dia in KM min and Est Dia in KM max
par(mfrow=c(2,1))  # Create two plots in a single window

# Histogram for Est Dia in KM min
hist(Ast_Subset$Est.Dia.in.KM.min., main="Distribution of Asteroid Diameter (Min)", xlab="Est Dia in KM (min)", col="blue")

# Histogram for Est Dia in KM max
hist(Ast_Subset$Est.Dia.in.KM.max., main="Distribution of Asteroid Diameter (Max)", xlab="Est Dia in KM (max)", col="green")

# Box plot for Est Dia in KM min
boxplot(Ast_Subset$Est.Dia.in.KM.min., main="Box Plot of Asteroid Diameter (Min)")

# Box plot for Est Dia in KM max
boxplot(Ast_Subset$Est.Dia.in.KM.max., main="Box Plot of Asteroid Diameter (Max)")


z_scores_min <- scale(Ast_Subset$Est.Dia.in.KM.min.)

z_scores_max <- scale(Ast_Subset$Est.Dia.in.KM.max.)

outliers_min <- which(abs(z_scores_min) > 5)  
outliers_max <- which(abs(z_scores_max) > 5)  

cleaned_data_min <- Ast_Subset[-outliers_min, ]
cleaned_data_max <- Ast_Subset[-outliers_max, ]

boxplot(cleaned_data_min, main="Box Plot of Asteroid Diameter (Min)")
boxplot(cleaned_data_max, main="Box Plot of Asteroid Diameter (Max)")



```


```{r}
find_outliers <- function(x) {
  q1 <- quantile(x, 0.25)
  q3 <- quantile(x, 0.75)
  iqr <- q3 - q1
  lower_bound <- q1 - 1.5 * iqr
  upper_bound <- q3 + 1.5 * iqr
  return(x[x < lower_bound | x > upper_bound])
}

# Find and remove outliers in the minimum diameter
outliers_min <- find_outliers(Ast_Subset$Est.Dia.in.KM.min.)
data_cleaned_min <- Ast_Subset[!(Ast_Subset$Est.Dia.in.KM.min. %in% outliers_min), ]

# Find and remove outliers in the maximum diameter
outliers_max <- find_outliers(Ast_Subset$Est.Dia.in.KM.max.)
data_cleaned_max <- Ast_Subset[!(Ast_Subset$Est.Dia.in.KM.max. %in% outliers_max), ]

par(mfrow=c(2,2))

hist(Ast_Subset$Est.Dia.in.KM.min., main="Minimum Diameter", xlab="Est Dia in KM (min)", col="blue")
hist(data_cleaned_min$Est.Dia.in.KM.min., main="Minimum Diameter (Cleaned)", xlab="Est Dia in KM (min)", col="blue")

hist(Ast_Subset$Est.Dia.in.KM.max., main="Maximum Diameter", xlab="Est Dia in KM (max)", col="blue")
hist(data_cleaned_max$Est.Dia.in.KM.max., main="Maximum Diameter (Cleaned)", xlab="Est Dia in KM (max)", col="blue")


# Q-Q plot for minimum asteroid diameter
#original data
qqnorm(Ast_Subset$Est.Dia.in.KM.min.)
qqline(Ast_Subset$Est.Dia.in.KM.min.)
#clean data
qqnorm(data_cleaned_min$Est.Dia.in.KM.min.)
qqline(data_cleaned_min$Est.Dia.in.KM.min.)


# Q-Q plot for maximum asteroid diameter

#original data
qqnorm(Ast_Subset$Est.Dia.in.KM.max.)
qqline(Ast_Subset$Est.Dia.in.KM.max.)
#clean data
qqnorm(data_cleaned_max$Est.Dia.in.KM.max.)
qqline(data_cleaned_max$Est.Dia.in.KM.max.)


shapiro.test(data_cleaned_min$Est.Dia.in.KM.min.)
shapiro.test(data_cleaned_max$Est.Dia.in.KM.max.)

#the p-values for both the minimum and maximum asteroid diameters are less than 2e-16, indicating that the data significantly deviates from a normal distribution.


```

