---
title: "EVALUATING ASTEROID CHARACTERISTICS AND CLASSIFYING ASTEROID THREAT ON PLANET EARTH"
author: "Vishal Bakshi, Pratiksha Dange, Sudanshu Dotel, Qibin Huang"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    number_sections: false
    toc: yes
    toc_depth: 3
    toc_float: yes
---


```{r init, include=FALSE}
# some of common options (and the defaults) are: 
# include=T, eval=T, echo=T, results='hide'/'asis'/'markup',..., collapse=F, warning=T, message=T, error=T, cache=T, fig.width=6, fig.height=4, fig.dim=c(6,4) #inches, fig.align='left'/'center','right', 
library(ezids)
# knitr::opts_chunk$set(warning = F, results = "markup", message = F)
knitr::opts_chunk$set(warning = F, results = "hide", message = F)
options(scientific=T, digits = 3) 
library(dplyr)
library(kableExtra)
library(ggplot2)
library(psych)

# options(scipen=9, digits = 3)  
# ‘scipen’: integer. A penalty to be applied when deciding to print numeric values in fixed or exponential notation.  Positive values bias towards fixed and negative towards scientific notation: fixed notation will be preferred unless it is more than ‘scipen’ digits wider.

# use scipen=999 to prevent scientific notation at all times
```


## Importing Dataset & Checking Summary Statistics

```{r, include=TRUE, echo=TRUE, results='show'}
# current_directory <- "/Users/vishal/Desktop/Way to New World/University/01_All_Semesters/01_Semester/03_Projects/01_DS/6101_Project_Data_Diggers/"
# data_path <- "Datasets/Asteroid_Hazard_Classification.csv"
# file_path <- file.path(dirname(current_directory), data_path)
Ast_raw <- data.frame(read.csv("Asteroid_Hazard_Classification.csv"))

Ast_raw
#kable(summary(Ast_raw), "html") %>%
  #kable_paper(full_width = FALSE) %>% 
  #scroll_box(width = "100%", height = "400px")


```



## Data Preprocessing

### Step : 1 : Converting the Hazard column from string to integer, and into categorical.

```{r, include=TRUE, echo=TRUE, results='show'}
Ast_raw <- Ast_raw %>%
mutate(Hazardous = as.integer(Hazardous))#(1 is True, 0 is False)

Ast_raw$Hazardous <- as.factor(Ast_raw$Hazardous)

kable(Ast_raw, "html") %>%
  kable_paper(full_width = FALSE) %>% 
  scroll_box(width = "100%", height = "400px")



```


### Step : 2 : Dropping columns which are not required for our analysis:

```{r, include=TRUE, echo=TRUE, results='asis'}

# According to the domain knowledge we acquired from the specific domain, these are the important variables which is mostly affecting the asteroid to be hazardous. 

selected_columns <- c('Absolute.Magnitude', 'Est.Dia.in.KM.min.', 'Est.Dia.in.KM.max.','Miss.Dist..kilometers.','Relative.Velocity.km.per.sec', 'Minimum.Orbit.Intersection','Jupiter.Tisserand.Invariant','Epoch.Osculation' ,'Eccentricity', 'Semi.Major.Axis', 'Inclination','Asc.Node.Longitude' ,'Orbital.Period' ,'Perihelion.Distance','Perihelion.Arg', 'Perihelion.Time','Mean.Anomaly','Aphelion.Dist', 'Mean.Motion', 'Hazardous')

Filtered_data <- subset(Ast_raw, select = selected_columns)

# Create a nicely formatted table
#kable(Ast_Subset, "html") %>%
  #kable_paper(full_width = FALSE) %>% 
  #scroll_box(width = "100%", height = "400px")
Filtered_data

```

### Step : 2.1: 

```{r, include= TRUE, echo=TRUE, results='markup'}

library(corrplot)
Filtered_data = Filtered_data[1:20]

subset <- as.data.frame(lapply(Filtered_data, as.numeric))
par(mfrow = c(1, 1)) # Adjust mar and oma for margins

M = cor(subset)
corrplot(M, method = 'number', number.cex = 0.8, tl.cex = 0.8)

# Note : Filtered Data is the data frame with outliers and skewness 


```
The reason to drop the columns is to easily carry out the inferences and also according to the domain knowledge we acquired, the columns which we dropped are not very useful for our analysis. 

Some of the columns are showing high multi-collinearity. We are dropping them such that we don't face any issue with the model. 


```{r}
histplots <- function(column) {
  Plot <- ggplot(Filtered_data, aes_string(x = column, group = "1")) +
    geom_histogram(bins=30)  + ggtitle("Hist Plots", column )
  return(Plot)
  
}

for(col in colnames(Filtered_data[1:19])) { 
  print(histplots(col))
}

```

### Box Plots of all the variables

```{r}
str(Filtered_data)

boxPlots <- function(column){
  Plot <- ggplot(Filtered_data, aes_string(x = column, group = "1")) +
    geom_boxplot() + coord_flip() + ggtitle("Box Plots", column )
  return(Plot)
}

for(col in colnames(Filtered_data[1:19])) { 
  print(boxPlots(col))
}




```

By carefully observing the box plots, there are some of the variables which have outliers and highly skewed. However we have to check the skewness after removing the outliers. 

### Outlier Removal

```{r}
reduced_df <- Filtered_data
columns_to_check <- names(reduced_df)[names(reduced_df) != "Hazardous"]

# Function to remove outliers based on IQR
remove_outliers <- function(x) {
  Q1 <- quantile(x, 0.25)
  Q3 <- quantile(x, 0.75)
  IQR_val <- Q3 - Q1
  lower_bound <- Q1 - 1.5 * IQR_val
  upper_bound <- Q3 + 1.5 * IQR_val
  return(ifelse(x >= lower_bound & x <= upper_bound, x, NA))
}

# Loop through columns (except 'Hazardous') and remove outliers
for (col in columns_to_check) {
  reduced_df[[col]] <- remove_outliers(reduced_df[[col]])
}

# Remove rows containing NA values after outlier removal
reduced_df <- reduced_df[complete.cases(reduced_df), ]

str(reduced_df)

```

### Box Plots After Outlier Removal. 

```{r}

boxPlots_ <- function(column){
  Plot <- ggplot(reduced_df, aes_string(x = column, group = "1")) +
    geom_boxplot() + coord_flip() + ggtitle("Box Plots", column )
  return(Plot)
}

for(col in colnames(reduced_df[1:19])) { 
  print(boxPlots_(col))
}


```
### Checking for Non-Null Values

```{r}

null_values <- colSums(is.na(reduced_df))
print("Null Values in Each Column:")
print(null_values)

```

### Skewness check using QQ-Plot

```{r}
qqplt <- function(df, col) {
  
  # Before Outlier Removal
  if (!all(is.na(Filtered_data[[col]]))) {
    qqnorm(Filtered_data[[col]], main = paste("Before Outlier Removal", col))
    qqline(Filtered_data[[col]])
  } else {
    cat("Skipping plot for", col, "due to missing or NA values.\n")
  }
  
  # After Outlier Removal
  if (!all(is.na(reduced_df[[col]]))) {
    qqnorm(reduced_df[[col]], main = paste("After Outlier Removal", col))
    qqline(reduced_df[[col]])
  } else {
    cat("Skipping plot for", col, "due to missing or NA values after outlier removal.\n")
  }
}

# Assuming 'columns_to_check' is a vector containing the column names you want to check

for (col in columns_to_check) {
  qqplt(df,col)
}

```


### Skewness removal

```{r}
# Applying Log Transforamtion on diameter. 


```

